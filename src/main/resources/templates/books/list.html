<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–Ω–ª–∞–π–Ω –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ - –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div class="container">
    <div class="top">
        <h1>üìö –û–Ω–ª–∞–π–Ω –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>
        <div class="auth-links">
            <span class="book-count">üìñ –í—Å–µ–≥–æ –∫–Ω–∏–≥: <strong th:text="${totalBooks}">0</strong></span>
            <a th:href="@{/logout}">–í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    <div class="search-container">
        <form method="get" th:action="@{/books}" class="search-form">
            <input type="text" name="search" th:value="${searchQuery}" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É –∏–ª–∏ –∂–∞–Ω—Ä—É..." class="search-input">
            <button type="submit" class="search-btn">–ù–∞–π—Ç–∏</button>
            <a th:if="${searchQuery}" th:href="@{/books}" class="clear-search">‚úï –û—á–∏—Å—Ç–∏—Ç—å</a>
        </form>
    </div>
    
    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filter-container">
        <form method="get" th:action="@{/books}" class="filter-form">
            <div class="filter-group">
                <label>–ñ–∞–Ω—Ä:</label>
                <select name="genre" class="filter-select">
                    <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                    <option th:each="g : ${genres}" 
                            th:value="${g}" 
                            th:text="${g}"
                            th:selected="${selectedGenre == g}"></option>
                </select>
            </div>
            <div class="filter-group">
                <label>–ì–æ–¥:</label>
                <input type="number" name="year" th:value="${selectedYear}" placeholder="–ì–æ–¥" min="1000" max="2100" class="filter-input">
            </div>
            <button type="submit" class="filter-btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
            <a th:if="${selectedGenre != null || selectedYear != null}" th:href="@{/books}" class="clear-filter">‚úï –°–±—Ä–æ—Å–∏—Ç—å</a>
        </form>
    </div>
    
    <div style="text-align: center; margin: 30px 0;">
        <a class="btn" th:href="@{/books/new}">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É</a>
    </div>
    
    <div th:if="${success}" class="success" th:text="${success}"></div>
    <div th:if="${error}" class="error" th:text="${error}"></div>
    
    <div th:if="${searchQuery}" class="search-results">
        <p>üîç –ù–∞–π–¥–µ–Ω–æ –∫–Ω–∏–≥: <strong th:text="${#lists.size(books)}">0</strong> –ø–æ –∑–∞–ø—Ä–æ—Å—É "<span th:text="${searchQuery}"></span>"</p>
    </div>
    
    <div th:if="${selectedGenre != null || selectedYear != null}" class="search-results">
        <p>üîç –ù–∞–π–¥–µ–Ω–æ –∫–Ω–∏–≥: <strong th:text="${#lists.size(books)}">0</strong> 
           <span th:if="${selectedGenre}">–ø–æ –∂–∞–Ω—Ä—É "<span th:text="${selectedGenre}"></span>"</span>
           <span th:if="${selectedGenre != null && selectedYear != null}"> –∏ </span>
           <span th:if="${selectedYear}">–∑–∞ <span th:text="${selectedYear}"></span> –≥–æ–¥</span>
        </p>
    </div>
    
    <div th:if="${#lists.isEmpty(books)}" class="empty-state">
        <div class="empty-icon">üìö</div>
        <h2 th:text="${searchQuery != null || selectedGenre != null || selectedYear != null ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—É—Å—Ç–∞'}"></h2>
        <p th:text="${searchQuery != null || selectedGenre != null || selectedYear != null ? '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞' : '–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–Ω–∏–≥—É –≤ –≤–∞—à—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É!'}"></p>
        <a th:if="${searchQuery == null && selectedGenre == null && selectedYear == null}" class="btn" th:href="@{/books/new}">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>
    </div>
    
    <div th:if="${!#lists.isEmpty(books)}" class="books-grid">
        <div th:each="book : ${books}" class="book-card">
            <div class="book-card-header">
                <h3 th:text="${book.title}">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</h3>
                <span class="book-id">#<span th:text="${book.id}">1</span></span>
            </div>
            <div class="book-card-body">
                <div class="book-info">
                    <p class="book-author">
                        <span class="info-label">üë§ –ê–≤—Ç–æ—Ä:</span>
                        <span th:text="${book.author}">–ê–≤—Ç–æ—Ä</span>
                    </p>
                    <p class="book-genre" th:if="${book.genre}">
                        <span class="info-label">üìö –ñ–∞–Ω—Ä:</span>
                        <span th:text="${book.genre}">–ñ–∞–Ω—Ä</span>
                    </p>
                    <p class="book-year" th:if="${book.year}">
                        <span class="info-label">üìÖ –ì–æ–¥:</span>
                        <span th:text="${book.year}">–ì–æ–¥</span>
                    </p>
                </div>
                <div class="book-description" th:if="${book.description}">
                    <p th:text="${#strings.abbreviate(book.description, 100)}">–û–ø–∏—Å–∞–Ω–∏–µ –∫–Ω–∏–≥–∏...</p>
                </div>
            </div>
            <div class="book-card-actions">
                <a th:href="@{'/books/' + ${book.id}}" class="action-btn view">üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                <a th:href="@{'/books/' + ${book.id} + '/edit'}" class="action-btn edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                <form th:action="@{'/books/' + ${book.id} + '/delete'}" method="post" style="display:inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="action-btn delete" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–Ω–∏–≥—É?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
</html>

